<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Graphrel</title>
    <link rel="stylesheet" type="text/css" href="http://w2ui.com/src/w2ui-1.4.2.min.css" />
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
    <script>
        if (!window.jQuery) { document.write('<script src="lib/jquery.min.js"><\/script>'); }
    </script>
    <script type="text/javascript" src="http://w2ui.com/src/w2ui-1.4.2.min.js"></script>
    <script>
        if (!window.w2ui) { document.write('<script src="lib/w2ui-1.4.2.min.js"><\/script>'); }
    </script>
</head>
<body>

    <div id="header">
        <h2>Graphrel—A simple relation-based WYSIWYG graph editor</h2>
        <p>under construction; check back later...</p>
    </div>

    <div id="control_buttons" style="position:relative;left:3px">
        <button class="btn" onclick="w2ui['layout'].toggle('top', window.instant)">Instructions</button>
        <button class="btn" onclick="w2ui['layout'].toggle('right', window.instant)">Relation Editor</button>
        <!--<input type="checkbox" id="instant" onclick="window.instant = this.checked;"> <label for="instant">Instant</label>-->
    </div>

    <div id="layout" style="position: absolute; top: 150px; bottom: 50px; left: 10px; right: 10px;"></div> <!--Use absolute positioning. This allows layout to be auto resized-->

    <div id="footer" style="position: absolute; bottom: 10px; left: 10px; right: 10px;"><p>awesome footer</p></div>

    <script type="text/javascript">
        /* Going with minimalist design here. Currently only support main editor (main), and adjacency list viewer/editor */
        $(function () {
            var pstyle = 'border: 1px solid #dfdfdf; padding: 5px;';
            $('#layout').w2layout({
                name: 'layout',
                padding: 4,
                panels: [
                    { type: 'top', style: pstyle, content: '<div id="instructions"><ul><li>Click in the open space to add a node, drag from one node to another to add an edge. Ctrl-drag a node to move the graph layout. Click a node or an edge to select it.</li><li>When a node is selected: R toggles reflexivity (loop), Delete removes the node. When an edge is selected: L(eft), R(ight), B(oth) change direction, Delete removes the edge.</li><li>Edit the adjacency list to see real-time updates. More features coming soon!</li></ul></div>' },
                    /* for some reason main iframe gets cropped if resized to roughly less than the svg width... currently put a hard limit on minSize */
                    { type: 'main', minSize: 480, resizable: true, style: pstyle, content: "<div id='graphContainer' style='width: 100%; height: 100%;'><iframe id='graph' scrolling='no' sandbox='allow-scripts allow-forms allow-same-origin' marginwidth='0' marginheight='0' frameborder='0' src='graph.html'></iframe></div>" },
                    { type: 'right', minSize: 200, size: '30%', resizable: true, style: pstyle, content: "<div style='width: 100%; height: 100%'><iframe id='adjlist' sandbox='allow-scripts allow-forms allow-same-origin' marginwidth='0' xmarginheight='0' frameborder='0' src='adjlist.html'></iframe></div>" },
                ]
            });
        });

        // this is needed before the graph iframe loads and renders using the x/ybounds
        $('graph').ready(function () {
            mainPanel = document.getElementById('layout_layout_panel_main');
            graphWin = window.frames['graph'].contentWindow;
            // dynamically reset force layout bounds on resize event completion
            w2ui['layout'].on('resize', function (event) {
                event.onComplete = function () {
                    graphWin.xbound = parseInt(mainPanel.style.width, 10);
                    graphWin.ybound = parseInt(mainPanel.style.height, 10);
                }
            });
        })

        // initialize textarea window
        // this should wait AFTER the adjacency list iframe finishes loading
        window.onload = function () {
            adjWin = window.frames['adjlist'].contentWindow;
            adjWin.init();
            graphWin.alBox = adjWin.document.getElementById('alBox');
            graphWin.updateAdjlistFrame();
        };

    </script>


</body>
</html>